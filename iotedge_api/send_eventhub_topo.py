import os
from azure.eventhub import EventHubProducerClient, EventData
import json
import datetime
from datetime import datetime,timedelta,tzinfo

CONNECTION_STR = "Endpoint=sb://nexxissandboxtest.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=Ekd8fXNpN5BUguwmYhzP8r2e/M0vFAJPm+AEhAnzWhM="
EVENTHUB_NAME = "topology_devprd01_100"

#CONNECTION_STR = "Endpoint=sb://iothub-ns-ne-nexxis-25158162-b0438eb667.servicebus.windows.net/;SharedAccessKeyName=service;SharedAccessKey=CwiyhizJG7P/B5mmuwX6t4QKj0szRdJ0sLvmvozjV90="
#EVENTHUB_NAME = "ne-nexxis-sandbox-care-io"

producer = EventHubProducerClient.from_connection_string(
    conn_str=CONNECTION_STR,
    eventhub_name=EVENTHUB_NAME
)
class UTC(tzinfo):
    __ZERO = timedelta(0)

    def utcoffset(self, dt):
        return self.__ZERO

    def tzname(self, dt):
        return "UTC"

    def dst(self, dt):
        return self.__ZERO

message_dict = { 'syslog5424_msg':{'topology':[{'Hostname':'nms-416083332039','cluster':[],'interfaces':['eth2'],'version':'1.17.01-74281','ReleaseVersion':'1.17.01.7428165d63acf0daa2f37b51969ea14fe124c8e7'},{'interfaces':['dvi1','audio1','eth0','audio2'],'Hostname':'mna-1890280514','guid':'d9b13d40-0870-1c02-e000-0004a5011c83','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['vd','audio2','eth0','vga','audio1'],'Hostname':'mna-2530062900','guid':'d9b13d40-0870-1c02-e000-0004a5230a7f','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio1','eth0','vga','audio2','vd'],'Hostname':'mna-2530062890','guid':'d9b13d40-0870-1c02-e000-0004a5230a80','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio1','eth0','vga','audio2','vd'],'Hostname':'mna-2530062153','guid':'d9b13d40-0870-1c02-e000-0004a5230a81','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio1','vd','eth0','vga','audio2'],'Hostname':'mna-2530062154','guid':'d9b13d40-0870-1c02-e000-0004a5230a84','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['eth0','audio2','dvi2','dvi1','audio1'],'Hostname':'mna-2530060718','guid':'d9b13d40-0870-1c02-e000-0004a5230b79','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio1','dvi1','dvi2','audio2','eth0'],'sources':[{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.25:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062224/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.48:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062224/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530062224-dvi1&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530062224-dvi1&subnet=10.143.1.0%2F24'}],'framerate':59981,'kbm':False,'source_type':'video','interface':'dvi1','resolution':'1280x1024','source_name':'dvi1-1-mna-2530062224','aspectratio':1.25}],'Hostname':'mna-2530062224','guid':'d9b13d40-0870-1c02-e000-0004a5240b41','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['dvi2','dvi1','audio1','eth0','audio2'],'sources':[{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.79:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062233/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.58:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062233/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530062233-dvi1&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530062233-dvi1&subnet=10.143.1.0%2F24'}],'framerate':50002,'kbm':False,'source_type':'video','interface':'dvi1','resolution':'1920x1080','source_name':'dvi1-1-mna-2530062233','aspectratio':1.7777777777777777}],'Hostname':'mna-2530062233','guid':'d9b13d40-0870-1c02-e000-0004a5240b77','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio2','eth0','audio1','dvi1','dvi2'],'sources':[{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.75:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062124/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.62:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530062124/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530062124-dvi1&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530062124-dvi1&subnet=10.143.1.0%2F24'}],'framerate':50002,'kbm':False,'source_type':'video','interface':'dvi1','resolution':'1920x1080','source_name':'dvi1-1-mna-2530062124','aspectratio':1.7777777777777777}],'Hostname':'mna-2530062124','guid':'d9b13d40-0870-1c02-e000-0004a5240b79','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'offline','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio2','eth0','dvi2','audio1','dvi1'],'sinks':[{'layout':'/Default/full.layout','slots':'1','conn':[{'slot':'1','source':'dvi1-1-mna-2530232346'}],'session-consistency':{'session':105,'uuid':[],'consistent':True},'refreshRate':60000,'sink_name':'mna-L11S120160210144338 0','interface':'dvi1','type':'video','resolution':'1920x1080'}],'Hostname':'mna-L11S120160210144338','guid':'d9b13d40-0870-1c02-e000-0004a52f1cb7','Gender':'DECODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['eth0','audio2','dvi2','dvi1','audio1'],'sinks':[{'layout':'/Default/full.layout','slots':'1','conn':[{'slot':'1','source':'dvi1-1-mna-2530232346'}],'session-consistency':{'session':107,'uuid':[],'consistent':True},'refreshRate':60000,'sink_name':'mna-2530264388 0','interface':'dvi1','type':'video','resolution':'1920x1080'},{'conn':[{'slot':'1','source':''}],'session-consistency':{'session':108,'uuid':['d9b13d40-0870-1c02-e000-0004a5400d8a'],'consistent':False},'sink_name':'mna-2530264388 2','interface':'audio2','type':'audio'}],'Hostname':'mna-2530264388','guid':'d9b13d40-0870-1c02-e000-0004a5400d8a','Gender':'DECODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['eth0','audio2','dvi1','audio1','dvi2'],'sinks':[{'layout':'/Default/full.layout','slots':'1','conn':[{'slot':'1','source':'dvi1-1-mna-2530232346'}],'session-consistency':{'session':106,'uuid':[],'consistent':True},'refreshRate':60000,'sink_name':'mna-L21S120200520142655 0','interface':'dvi1','type':'video','resolution':'1920x1080'}],'Hostname':'mna-L21S120200520142655','guid':'d9b13d40-0870-1c02-e000-0004a5440dba','Gender':'DECODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['eth0','audio2','dvi2','dvi1','audio1'],'sinks':[{'layout':'/Default/full.layout','slots':'1','conn':[{'slot':'1','source':'dvi1-1-mna-2530232346'}],'session-consistency':{'session':104,'uuid':[],'consistent':True},'refreshRate':60000,'sink_name':'mna-L21S120200520083100 0','interface':'dvi1','type':'video','resolution':'1920x1080'}],'Hostname':'mna-L21S120200520083100','guid':'d9b13d40-0870-1c02-e000-0004a5440dbf','Gender':'DECODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['dvi1','audio1','dvi2','eth0','audio2'],'sources':[{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.16:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530209197/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.45:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi1-1-mna-2530209197/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530209197-dvi1&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530209197-dvi1&subnet=10.143.1.0%2F24'}],'framerate':49902,'kbm':False,'source_type':'video','interface':'dvi1','resolution':'1280x720','source_name':'dvi1-1-mna-2530209197','aspectratio':1.7777777777777777},{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.18:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi2-2-mna-2530209197/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.45:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi2-2-mna-2530209197/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530209197-dvi2&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530209197-dvi2&subnet=10.143.1.0%2F24'}],'framerate':49902,'kbm':False,'source_type':'video','interface':'dvi2','resolution':'1280x720','source_name':'dvi2-2-mna-2530209197','aspectratio':1.7777777777777777},{'components':['w0'],'children':[{'name':'audio/x-netviz-uncompressed','uri':'udp://239.1.1.17:5004'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530209197-audio1&subnet=10.143.1.0%2F24'}],'kbm':False,'source_type':'audio','interface':'audio1','source_name':'audio1-4-mna-2530209197'}],'Hostname':'mna-2530209197','guid':'d9b13d40-0870-1c02-e000-0004a54c1c2a','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audio1','dvi1','dvi2','audio2','eth0'],'Hostname':'mna-2530209201','guid':'d9b13d40-0870-1c02-e000-0004a54c1c48','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['dvi1','audio1','dvi2','eth0','audio2'],'sources':[{'components':['w0'],'children':[{'name':'audio/x-netviz-uncompressed','uri':'udp://239.1.1.21:5004'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530209196-audio1&subnet=10.143.1.0%2F24'}],'kbm':False,'source_type':'audio','interface':'audio1','source_name':'audio1-4-mna-2530209196'}],'Hostname':'mna-2530209196','guid':'d9b13d40-0870-1c02-e000-0004a54c1c5b','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['audioIn','hdmiIn1','hdmiIn2','audioOut','eth'],'sources':[{'components':['downscaled','left','right','downscaled_3d','left_3d','right_3d'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.210:5004'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-420-2530203340_hdmiIn1&subnet=10.143.1.0%2F24&sapversion=2'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/hdmiIn1-0-mna-420-2530203340/thumbnail'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/hdmiIn1-0-mna-420-2530203340/thumbnail'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-420-2530203340_hdmiIn1&subnet=10.143.1.0%2F24&resolution=hd&sapversion=2'},{'name':'application/x-vnc','uri':'tcp://10.143.1.51:5901'},{'name':'application/x-barco-3d','uri':'sap://224.2.127.254:9875/?s=mna-420-2530203340_hdmiIn1&subnet=10.143.1.0%2F24&sapversion=2&3d=True'}],'framerate':60000,'kbm':False,'source_type':'video','interface':'hdmiIn1','resolution':'1280x1024','source_name':'hdmiIn1-0-mna-420-2530203340','aspectratio':1.25}],'Hostname':'mna-420-2530203340','guid':'d9b13d40-0870-1c02-e000-0004a54e281a','Gender':'ENCODER','Firmware':'1.3.1-6-geda79b3','class':'MNA-420','status':'offline','ReleaseVersion':'-'},{'interfaces':['audio2','eth0','audio1','dvi1','dvi2'],'sources':[{'components':['w0'],'children':[{'name':'video/x-netviz-uncompressed','uri':'udp://239.1.1.15:5004'},{'name':'multipart/x-mixed-replace','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi2-2-mna-2530232351/thumbnail'},{'name':'application/x-vnc','uri':'tcp://10.143.1.44:5901'},{'name':'image/jpeg','uri':'https://10.143.1.10:8443/barco-webservice/rest/NetworkWall/source/dvi2-2-mna-2530232351/thumbnail'},{'name':'application/x-barco-sdp-in-sap','uri':'sap://224.2.127.254:9875/?s=mna-2530232351-dvi2&subnet=10.143.1.0%2F24'},{'name':'application/x-barco-downscaled','uri':'sap://224.2.127.254:9875/?s=mna-2530232351-dvi2&subnet=10.143.1.0%2F24'}],'framerate':59926,'kbm':False,'source_type':'video','interface':'dvi2','resolution':'1920x1080','source_name':'dvi2-2-mna-2530232351','aspectratio':1.7777777777777777}],'Hostname':'mna-2530232351','guid':'d9b13d40-0870-1c02-e000-0004a5511c0c','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['eth0','audio2','dvi1','audio1','dvi2'],'Hostname':'mna-2530232346','guid':'d9b13d40-0870-1c02-e000-0004a5511c0f','Gender':'ENCODER','Firmware':'v1.09.01-svn11980','class':'NETVIZDONGLE','status':'online','ReleaseVersion':'v1.09.01-svn11980'},{'interfaces':['hdmiIn1','audioIn','eth','hdmiIn2','audioOut'],'Hostname':'mna-420-2530489553','guid':'d9b13d40-0870-1c02-e000-0004a5520d60','Gender':'ENCODER','Firmware':'1.4.0-1-g6b58ec5','class':'MNA-420','status':'offline','ReleaseVersion':'-'}],'orId':'NOI-IN-TST-1','events':[{'source-unavailable':'dvi1-1-mna-2530232351'}],'timestamp':'2023-10-04T06:49:40.455Z'}}

#message_dict = {"syslog5424_msg":{"topology":[{"Hostname":"nms-416083332039","cluster":["10.99.112.3"],"interfaces":["eth0"],"version":"1.18.04-5e298","ReleaseVersion":"1.18.04.5e298678e36e1396d4e806ee822f890591f53a5b"},{"interfaces":["audioIn","eth","dpIn0","audioOut"],"Hostname":"mna-2530062900","guid":"d9b13d40-0870-1c02-e000-b0d5cc786dd31","Gender":"ENCODER","Firmware":"2.7.1-3-gda67ad2","class":"MNA-240","status":"online","ReleaseVersion":"2.8.0-37-gfae5aa0"},{"interfaces":["audioIn","eth","dpIn0","audioOut"],"Hostname":"mna-2530062901","guid":"d9b13d40-0870-1c02-e000-b0d5cc786dd32","Gender":"ENCODER","Firmware":"2.7.1-3-gda67ad2","class":"MNA-240","status":"online","ReleaseVersion":"2.8.0-37-gfae5aa0"},{"interfaces":["audioIn","eth","dpIn0","audioOut"],"Hostname":"mna-2530062902","guid":"d9b13d40-0870-1c02-e000-b0d5cc786dd33","Gender":"ENCODER","Firmware":"2.7.1-3-gda67ad2","class":"MNA-240","status":"online","ReleaseVersion":"2.8.0-37-gfae5aa0"},{"interfaces":["audioIn","eth","dpIn0","audioOut"],"Hostname":"mna-2530062903","guid":"d9b13d40-0870-1c02-e000-b0d5cc786dd34","Gender":"ENCODER","Firmware":"2.7.1-3-gda67ad2","class":"MNA-240","status":"online","ReleaseVersion":"2.8.0-37-gfae5aa0"},{"interfaces":["audioIn","eth","dpIn0","audioOut"],"Hostname":"mna-2530062904","guid":"d9b13d40-0870-1c02-e000-b0d5cc786dd35","Gender":"ENCODER","Firmware":"2.7.1-3-gda67ad2","class":"MNA-240","status":"online","ReleaseVersion":"2.8.0-37-gfae5aa0"}],"orId":"or_id","events":[{"mode-online":"d9b13d40-0870-1c02-e000-b0d5cc786dd31"}],"timestamp":"time_stamp"}}
#event_data_batch = producer.create_batch()

OR_NAME = 'NOI-IN-ETH-'
DEVICE_NAME = 'mna-240-enc-1234567-'

ors = 10
devices = 10
for i in range(ors):
    or_id = OR_NAME + str(i)
    event_data_batch = producer.create_batch()
    for j in range(devices):
        current_timestamp = datetime.now(UTC()).strftime('%Y-%m-%dT%H:%M:%S.%f')[:-3] + 'Z'
        device_id = DEVICE_NAME + str(j)

        message_dict['syslog5424_msg']['orId'] = or_id
        message_dict['syslog5424_msg']['timestamp'] = current_timestamp

        message = json.dumps(message_dict)

        event_data_batch.add(EventData(message))
    producer.send_batch(event_data_batch)
print("sent 100 records")
